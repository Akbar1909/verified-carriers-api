// ----------------------------
// UPDATED PRISMA SCHEMA
// ----------------------------
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication and profile
// In your prisma schema file

// User registration status enum
enum UserProfileStatus {
  INITIAL       // Just registered with basic info
  COMPLETE      // Completed full profile
}

model User {
  id            String            @id @default(cuid())
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  firstName     String
  lastName      String
  email         String            @unique
  password      String            // Hashed password
  
  // Profile status
  profileStatus UserProfileStatus @default(INITIAL)
  
  // User profile information
  visibleName   String?
  phoneNumber   String?
  contactEmail  String?           // This can be different from auth email
  country       String?
  state         String?
  bio           String?           @db.Text
  
  // Social media
  twitter       String?
  linkedin      String?
  facebook      String?
  
  // Relations
  reviews       Review[]
  image         File?             @relation("UserProfileImage")
  
  @@map("users")
}

// Registration status enum
enum RegistrationStatus {
  INITIAL      // Just created account with basic info
  COMPLETE     // Completed full profile
  VERIFIED     // Company has been verified by admin
}

// Company model
model Company {
  id                String            @id @default(cuid())
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  // Basic info
  name              String
  website           String?
  salesEmail        String?
  contactPhone      String?
  mcNumber          String?           @unique // MC#
  usdotNumber       String?           @unique // USDOT#
  foundingYear      Int?
  totalEmployees    Int?
  aboutCompany      String?           @db.Text
  
  // Authentication (for company accounts)
  workEmail         String            @unique  // Required for company login
  password          String            // Hashed password, for company login
  
  // Registration and verification status
  registrationStatus RegistrationStatus @default(INITIAL)
  isVerified        Boolean           @default(false)
  verifiedAt        DateTime?
  verifiedBy        String?           // Could be admin ID or system identifier
  
  // Relations
  companyLogos      CompanyLogo[]
  services          Service[]
  contactInformation ContactInformation[]
  reviews           Review[]
  
  @@map("companies")
}

// File model for all uploads
model File {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  originalName  String
  filename      String   // Stored filename
  path          String   // File path on server
  mimeType      String
  size          Int
  
  // Relations - a file can only be associated with one entity
  userImage     User?    @relation("UserProfileImage", fields: [userId], references: [id])
  userId        String?  @unique
  
  companyLogo   CompanyLogo? @relation("LogoFile", fields: [companyLogoId], references: [id])
  companyLogoId String?  @unique
  
  reviewPhoto   ReviewPhoto? @relation("ReviewFile", fields: [reviewPhotoId], references: [id])
  reviewPhotoId String?  @unique
  
  @@map("files")
}

// Company Logo model
model CompanyLogo {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String
  file      File?    @relation("LogoFile")
  
  @@map("company_logos")
}

// Service Types enum
enum ServiceType {
  FULL_TRUCKLOAD
  LESS_THAN_TRUCKLOAD
  INTERMODAL
  REFRIGERATED
  FLATBED
  HEAVY_HAUL
  EXPEDITED
  HAZARDOUS_MATERIALS
  WHITE_GLOVE
  LAST_MILE
  WAREHOUSING
  CROSS_BORDER
  OTHER
}

// Company services model
model Service {
  id          String      @id @default(cuid())
  createdAt   DateTime    @default(now())
  serviceName ServiceType // Using enum for consistency
  description String?     @db.Text
  company     Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId   String
  
  @@map("services")
}

// Contact information model
model ContactInformation {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  phone         String?
  email         String?
  officeAddress String?  @db.Text
  contactType   String?  // e.g., "Sales", "Support", "Operations"
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId     String
  
  @@map("contact_information")
}

// Review model
model Review {
  id                  String        @id @default(cuid())
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  rating              Int           // 1-5
  reviewText          String        @db.Text
  pickupState         String?
  deliveryState       String?
  deliveryDate        DateTime?
  transportationPrice Decimal?      @db.Decimal(10, 2)
  
  // Additional useful review metadata
  isVerified          Boolean       @default(false) // If the review has been verified
  shipmentType        String?       // Type of shipment
  
  // For review moderation
  isPublished         Boolean       @default(true)
  moderatedAt         DateTime?
  moderatedBy         String?
  
  // Relations
  photos              ReviewPhoto[]
  user                User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId              String
  company             Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId           String
  
  @@map("reviews")
}

// Review photos model
model ReviewPhoto {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  reviewId  String
  file      File?    @relation("ReviewFile")
  
  @@map("review_photos")
}